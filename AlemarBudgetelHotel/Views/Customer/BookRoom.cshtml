@model AlemarBudgetelHotel.Models.Room

@{
    ViewData["Title"] = "Book Room";
}

<div class="container mt-5">
    <div class="row">
        <div class="col-md-8">
            <div class="card shadow">
                <div class="card-header bg-primary text-white">
                    <h3><i class="fas fa-calendar-check"></i> Book Room @Model.RoomNumber</h3>
                </div>
                <div class="card-body">
                    @if (ViewBag.Error != null)
                    {
                        <div class="alert alert-danger">
                            <i class="fas fa-exclamation-circle"></i> @ViewBag.Error
                        </div>
                    }

                    <form method="post" asp-controller="Customer" asp-action="CreateReservation" id="bookingForm">
                        <input type="hidden" name="roomId" value="@Model.RoomId" />
                        <input type="hidden" name="numberOfGuests" value="1" />

                        <!-- Check-in Date & Time (Automatic - Current Time) -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">Check-in Date & Time</label>
                            <input type="text" class="form-control" readonly
                                   value="@DateTime.Now.ToString("MMMM dd, yyyy hh:mm tt")"
                                   style="background-color: #e9ecef;" />
                            <small class="text-muted"><i class="fas fa-info-circle"></i> Check-in starts immediately</small>
                        </div>

                        <!-- Duration Selection -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">Select Duration</label>
                            <select name="duration" id="durationSelect" class="form-select" required>
                                <option value="">-- Select Duration --</option>
                                <option value="0" data-hours="3" data-price="@Model.Price3Hours">3 Hours - ₱@Model.Price3Hours.ToString("N2")</option>
                                <option value="1" data-hours="12" data-price="@Model.Price12Hours">12 Hours - ₱@Model.Price12Hours.ToString("N2")</option>
                                <option value="2" data-hours="24" data-price="@Model.Price24Hours">24 Hours - ₱@Model.Price24Hours.ToString("N2")</option>
                            </select>
                        </div>

                        <!-- Check-out Date & Time (Auto-calculated) -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">Check-out Date & Time</label>
                            <input type="text" id="checkOutDisplay" class="form-control" readonly
                                   placeholder="Select duration to see check-out time"
                                   style="background-color: #e9ecef;" />
                        </div>

                        <!-- Number of Guests (Fixed at 1) -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">Number of Guests</label>
                            <input type="text" class="form-control" readonly
                                   value="1 Guest"
                                   style="background-color: #e9ecef;" />
                            <small class="text-muted"><i class="fas fa-info-circle"></i> Default: 1 guest (Maximum capacity: @Model.Capacity guests)</small>
                        </div>

                        <!-- Special Requests (Optional) -->
                        <div class="mb-3">
                            <label class="form-label fw-bold">Special Requests (Optional)</label>
                            <textarea name="specialRequests" class="form-control" rows="3"
                                      placeholder="Any special requirements or preferences..."></textarea>
                        </div>

                        <!-- Booking Summary -->
                        <div class="alert alert-info">
                            <h5><i class="fas fa-info-circle"></i> Booking Summary</h5>
                            <p class="mb-1"><strong>Room:</strong> @Model.RoomNumber - @Model.Type</p>
                            <p class="mb-1"><strong>Check-in:</strong> @DateTime.Now.ToString("MMM dd, yyyy hh:mm tt")</p>
                            <p class="mb-1"><strong>Guests:</strong> 1 person</p>
                            <p class="mb-1"><strong>Total Amount:</strong> <span id="totalAmount" class="text-primary fs-4">₱0.00</span></p>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-grid gap-2">
                            <button type="submit" class="btn btn-primary btn-lg">
                                <i class="fas fa-arrow-right"></i> Proceed to Payment
                            </button>
                            <a href="/Customer/Rooms" class="btn btn-outline-secondary">
                                <i class="fas fa-arrow-left"></i> Back to Rooms
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Room Details Sidebar -->
        <div class="col-md-4">
            <div class="card shadow">
                <div class="card-header bg-info text-white">
                    <h5><i class="fas fa-info"></i> Room Details</h5>
                </div>
                <div class="card-body">
                    <div class="room-image-placeholder mb-3 text-center">
                        <i class="fas fa-bed fa-5x text-muted"></i>
                    </div>
                    <h5>@Model.Type Room</h5>
                    <p class="text-muted mb-2">@Model.Description</p>

                    <hr>

                    <h6><i class="fas fa-tag"></i> Pricing</h6>
                    <ul class="list-unstyled mb-3">
                        <li class="mb-2">
                            <i class="fas fa-clock text-primary"></i> 3 Hours:
                            <strong class="float-end">₱@Model.Price3Hours.ToString("N2")</strong>
                        </li>
                        <li class="mb-2">
                            <i class="fas fa-clock text-primary"></i> 12 Hours:
                            <strong class="float-end">₱@Model.Price12Hours.ToString("N2")</strong>
                        </li>
                        <li>
                            <i class="fas fa-clock text-primary"></i> 24 Hours:
                            <strong class="float-end">₱@Model.Price24Hours.ToString("N2")</strong>
                        </li>
                    </ul>

                    <hr>

                    <h6><i class="fas fa-info-circle"></i> Room Information</h6>
                    <div class="mb-2">
                        <i class="fas fa-door-open text-info"></i>
                        <strong>Room Number:</strong> @Model.RoomNumber
                    </div>
                    <div class="mb-2">
                        <i class="fas fa-users text-info"></i>
                        <strong>Capacity:</strong> Up to @Model.Capacity guests
                    </div>
                    <div class="mb-2">
                        <i class="fas fa-building text-info"></i>
                        <strong>Floor:</strong> @Model.Floor
                    </div>
                    <div class="mb-3">
                        <i class="fas fa-check-circle text-success"></i>
                        <strong>Status:</strong> <span class="badge bg-success">Available</span>
                    </div>

                    <hr>

                    <div class="alert alert-success mb-0">
                        <h6><i class="fas fa-shield-alt"></i> Next Step</h6>
                        <p class="mb-0 small">After booking, you'll proceed to the GCash payment page to complete your reservation securely.</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const durationSelect = document.getElementById('durationSelect');
            const checkOutDisplay = document.getElementById('checkOutDisplay');
            const totalAmountDisplay = document.getElementById('totalAmount');

            // Calculate check-out time and total when duration changes
            durationSelect.addEventListener('change', function() {
                const selectedOption = this.options[this.selectedIndex];

                if (this.value !== '') {
                    const hours = parseInt(selectedOption.dataset.hours);
                    const price = parseFloat(selectedOption.dataset.price);

                    // Calculate check-out time from current time
                    const checkIn = new Date();
                    const checkOut = new Date(checkIn.getTime() + (hours * 60 * 60 * 1000));

                    // Format check-out display
                    const options = { year: 'numeric', month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit' };
                    checkOutDisplay.value = checkOut.toLocaleDateString('en-US', options);

                    // Update total amount
                    totalAmountDisplay.textContent = '₱' + price.toFixed(2);
                } else {
                    checkOutDisplay.value = '';
                    totalAmountDisplay.textContent = '₱0.00';
                }
            });

            // Form validation
            document.getElementById('bookingForm').addEventListener('submit', function(e) {
                if (durationSelect.value === '') {
                    e.preventDefault();
                    alert('Please select a duration');
                    return false;
                }
            });
        });
    </script>
}
